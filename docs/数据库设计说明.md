# WQS IoT Gateway 数据库设计说明

## 概述

本文档详细说明了WQS IoT Gateway平台的数据库设计，包括表结构、字段定义、索引设计和数据关系。

### 数据库信息

- **数据库名称**: `iot_gateway`
- **字符集**: `utf8mb4`
- **排序规则**: `utf8mb4_unicode_ci`
- **存储引擎**: InnoDB
- **版本管理**: Flyway

## 表结构设计

### 目录

- [产品相关表](#产品相关表)
  - [iot_product - 产品表](#iot_product)
  - [iot_product_property - 产品属性表](#iot_product_property)
  - [iot_product_property_mapping - 寄存器映射表](#iot_product_property_mapping)
- [设备相关表](#设备相关表)
  - [iot_device - 设备表](#iot_device)
  - [iot_device_data - 设备数据表](#iot_device_data)
- [规则引擎表](#规则引擎表)
  - [iot_rule - 规则表](#iot_rule)
  - [iot_rule_log - 规则执行日志表](#iot_rule_log)
- [系统管理表](#系统管理表)
  - [sys_user - 用户表](#sys_user)
  - [sys_role - 角色表](#sys_role)

---

## 产品相关表

### iot_product

产品表，定义设备产品的基本信息和物模型。

#### 表结构

| 字段名 | 类型 | 长度 | 允许NULL | 默认值 | 说明 |
|--------|------|------|---------|--------|------|
| id | VARCHAR | 50 | NO | - | 主键ID |
| product_name | VARCHAR | 100 | NO | - | 产品名称 |
| product_key | VARCHAR | 50 | NO | - | 产品标识（唯一） |
| protocol_type | VARCHAR | 20 | NO | - | 协议类型：MODBUS_TCP/MODBUS_RTU/S7/BACNET |
| product_desc | TEXT | - | YES | - | 产品描述 |
| status | VARCHAR | 20 | NO | ENABLE | 状态：ENABLE-启用/DISABLE-禁用 |
| sort_code | INT | - | YES | 100 | 排序码 |
| ext_json | TEXT | - | YES | - | 扩展信息（JSON） |
| create_time | DATETIME | - | NO | - | 创建时间 |
| create_user | VARCHAR | 50 | NO | - | 创建人 |
| update_time | DATETIME | - | YES | - | 更新时间 |
| update_user | VARCHAR | 50 | YES | - | 更新人 |
| delete_flag | VARCHAR | 20 | NO | NOT_DELETE | 删除标记 |

#### 索引

```sql
PRIMARY KEY (id)
UNIQUE INDEX uk_product_key (product_key)
INDEX idx_status (status)
INDEX idx_create_time (create_time)
```

#### 示例数据

```sql
INSERT INTO iot_product VALUES (
  '1',
  '温湿度传感器',
  'TH_SENSOR_01',
  'MODBUS_TCP',
  '工业级温湿度传感器，支持ModbusTCP协议',
  'ENABLE',
  100,
  NULL,
  NOW(),
  'admin',
  NULL,
  NULL,
  'NOT_DELETE'
);
```

---

### iot_product_property

产品属性表，定义产品物模型的属性、命令和报警。

#### 表结构

| 字段名 | 类型 | 长度 | 允许NULL | 默认值 | 说明 |
|--------|------|------|---------|--------|------|
| id | VARCHAR | 50 | NO | - | 主键ID |
| product_id | VARCHAR | 50 | NO | - | 产品ID |
| property_name | VARCHAR | 100 | NO | - | 属性名称 |
| property_key | VARCHAR | 50 | NO | - | 属性标识 |
| property_type | VARCHAR | 20 | NO | - | 属性类型：PROPERTY-属性/COMMAND-命令/ALARM-报警 |
| data_type | VARCHAR | 20 | NO | - | 数据类型：INT/FLOAT/STRING/BOOLEAN |
| unit | VARCHAR | 20 | YES | - | 单位 |
| rw_type | VARCHAR | 10 | YES | - | 读写类型：R-只读/RW-读写 |
| property_desc | TEXT | - | YES | - | 属性描述 |
| sort_code | INT | - | YES | 100 | 排序码 |
| ext_json | TEXT | - | YES | - | 扩展信息（JSON） |
| create_time | DATETIME | - | NO | - | 创建时间 |
| create_user | VARCHAR | 50 | NO | - | 创建人 |
| update_time | DATETIME | - | YES | - | 更新时间 |
| update_user | VARCHAR | 50 | YES | - | 更新人 |
| delete_flag | VARCHAR | 20 | NO | NOT_DELETE | 删除标记 |

#### 索引

```sql
PRIMARY KEY (id)
INDEX idx_product_id (product_id)
INDEX idx_property_type (property_type)
UNIQUE INDEX uk_product_property (product_id, property_key)
```

#### 示例数据

```sql
-- 温度属性
INSERT INTO iot_product_property VALUES (
  '1',
  '1',
  '温度',
  'temperature',
  'PROPERTY',
  'FLOAT',
  '℃',
  'R',
  '环境温度测量值',
  100,
  NULL,
  NOW(),
  'admin',
  NULL,
  NULL,
  'NOT_DELETE'
);

-- 湿度属性
INSERT INTO iot_product_property VALUES (
  '2',
  '1',
  '湿度',
  'humidity',
  'PROPERTY',
  'FLOAT',
  '%RH',
  'R',
  '环境湿度测量值',
  101,
  NULL,
  NOW(),
  'admin',
  NULL,
  NULL,
  'NOT_DELETE'
);
```

---

### iot_product_property_mapping

寄存器映射表，定义协议寄存器地址与物模型属性的映射关系。

#### 表结构

| 字段名 | 类型 | 长度 | 允许NULL | 默认值 | 说明 |
|--------|------|------|---------|--------|------|
| id | VARCHAR | 50 | NO | - | 主键ID |
| product_id | VARCHAR | 50 | NO | - | 产品ID |
| property_id | VARCHAR | 50 | NO | - | 属性ID |
| function_code | INT | - | YES | - | Modbus功能码：03/04/05/06等 |
| start_address | INT | - | YES | - | 起始地址 |
| register_count | INT | - | YES | 1 | 寄存器数量 |
| data_type | VARCHAR | 50 | YES | - | 数据类型：INT16/UINT16/INT32/FLOAT32等 |
| byte_order | VARCHAR | 20 | YES | - | 字节序：BIG_ENDIAN/LITTLE_ENDIAN |
| bit_index | INT | - | YES | - | 位索引（线圈地址） |
| scale_factor | DECIMAL | 10,4 | YES | 1.0000 | 缩放因子 |
| storage_area | VARCHAR | 10 | YES | - | S7存储区：DB/M/I/Q/T/C |
| db_number | INT | - | YES | - | S7 DB块号 |
| object_type | VARCHAR | 20 | YES | - | BACnet对象类型：AI/AO/BI/BO等 |
| object_instance | INT | - | YES | - | BACnet对象实例 |
| ext_config | TEXT | - | YES | - | 扩展配置（JSON） |
| create_time | DATETIME | - | NO | - | 创建时间 |
| create_user | VARCHAR | 50 | NO | - | 创建人 |
| update_time | DATETIME | - | YES | - | 更新时间 |
| update_user | VARCHAR | 50 | YES | - | 更新人 |
| delete_flag | VARCHAR | 20 | NO | NOT_DELETE | 删除标记 |

#### 索引

```sql
PRIMARY KEY (id)
INDEX idx_product_id (product_id)
INDEX idx_property_id (property_id)
UNIQUE INDEX uk_product_property_mapping (product_id, property_id)
```

#### 协议字段说明

**Modbus 协议字段**
- `function_code`: 功能码（03=读保持寄存器，04=读输入寄存器）
- `start_address`: 寄存器起始地址
- `data_type`: INT16/UINT16/INT32/UINT32/FLOAT32
- `byte_order`: BIG_ENDIAN（大端）/LITTLE_ENDIAN（小端）
- `scale_factor`: 数据缩放因子（如0.1表示原始值除以10）

**S7 协议字段**
- `storage_area`: 存储区（DB/M/I/Q/T/C）
- `db_number`: DB块编号
- `start_address`: 字节偏移地址
- `bit_index`: 位偏移（BOOL类型）
- `data_type`: BOOL/BYTE/INT/DINT/REAL

**BACnet 协议字段**
- `object_type`: 对象类型（AI/AO/BI/BO/AV/BV）
- `object_instance`: 对象实例编号
- `ext_config`: 属性标识（如Present_Value）

#### 示例数据

**Modbus 映射示例**
```sql
INSERT INTO iot_product_property_mapping VALUES (
  '1',
  '1',  -- 产品ID
  '1',  -- 属性ID（温度）
  03,   -- 功能码
  0,    -- 起始地址
  1,    -- 寄存器数量
  'INT16',
  'BIG_ENDIAN',
  NULL,
  0.1,  -- 缩放因子
  NULL, NULL, NULL, NULL,
  NULL,
  NOW(),
  'admin',
  NULL, NULL,
  'NOT_DELETE'
);
```

**S7 映射示例**
```sql
INSERT INTO iot_product_property_mapping VALUES (
  '2',
  '2',  -- 产品ID
  '3',  -- 属性ID
  NULL, NULL, NULL, NULL, NULL, NULL,
  NULL,
  'DB',   -- 存储区
  1,      -- DB块号
  NULL, NULL,
  '{"dataType":"REAL","byteOffset":0}',
  NOW(),
  'admin',
  NULL, NULL,
  'NOT_DELETE'
);
```

---

## 设备相关表

### iot_device

设备表，存储设备实例信息和连接配置。

#### 表结构

| 字段名 | 类型 | 长度 | 允许NULL | 默认值 | 说明 |
|--------|------|------|---------|--------|------|
| id | VARCHAR | 50 | NO | - | 主键ID |
| device_name | VARCHAR | 100 | NO | - | 设备名称 |
| device_code | VARCHAR | 50 | NO | - | 设备编号（唯一） |
| product_id | VARCHAR | 50 | NO | - | 产品ID |
| device_desc | TEXT | - | YES | - | 设备描述 |
| device_address | TEXT | - | YES | - | 设备地址配置（JSON） |
| online_status | VARCHAR | 20 | NO | OFFLINE | 在线状态：ONLINE/OFFLINE |
| last_online_time | DATETIME | - | YES | - | 最后在线时间 |
| status | VARCHAR | 20 | NO | ENABLE | 状态：ENABLE/DISABLE |
| sort_code | INT | - | YES | 100 | 排序码 |
| ext_json | TEXT | - | YES | - | 扩展信息（JSON） |
| create_time | DATETIME | - | NO | - | 创建时间 |
| create_user | VARCHAR | 50 | NO | - | 创建人 |
| update_time | DATETIME | - | YES | - | 更新时间 |
| update_user | VARCHAR | 50 | YES | - | 更新人 |
| delete_flag | VARCHAR | 20 | NO | NOT_DELETE | 删除标记 |

#### 索引

```sql
PRIMARY KEY (id)
UNIQUE INDEX uk_device_code (device_code)
INDEX idx_product_id (product_id)
INDEX idx_online_status (online_status)
INDEX idx_status (status)
```

#### device_address 字段格式

**Modbus TCP**
```json
{
  "host": "192.168.1.100",
  "port": 502,
  "slaveId": 1
}
```

**Modbus RTU**
```json
{
  "port": "COM1",
  "baudRate": 9600,
  "dataBits": 8,
  "stopBits": 1,
  "parity": "NONE",
  "slaveId": 1
}
```

**S7**
```json
{
  "host": "192.168.1.100",
  "port": 102,
  "rack": 0,
  "slot": 1
}
```

**BACnet**
```json
{
  "host": "192.168.1.100",
  "port": 47808,
  "deviceInstance": 1001
}
```

#### 示例数据

```sql
INSERT INTO iot_device VALUES (
  '1',
  '1号车间温湿度传感器',
  'DEV_TH_001',
  '1',
  '位于1号车间A区',
  '{"host":"192.168.1.100","port":502,"slaveId":1}',
  'ONLINE',
  NOW(),
  'ENABLE',
  100,
  NULL,
  NOW(),
  'admin',
  NULL, NULL,
  'NOT_DELETE'
);
```

---

### iot_device_data

设备数据表，存储设备采集的实时和历史数据。

#### 表结构

| 字段名 | 类型 | 长度 | 允许NULL | 默认值 | 说明 |
|--------|------|------|---------|--------|------|
| id | VARCHAR | 50 | NO | - | 主键ID |
| device_id | VARCHAR | 50 | NO | - | 设备ID |
| property_key | VARCHAR | 50 | NO | - | 属性标识 |
| property_value | VARCHAR | 500 | YES | - | 属性值 |
| data_type | VARCHAR | 20 | NO | - | 数据类型 |
| collect_time | DATETIME | - | NO | - | 采集时间 |
| create_time | DATETIME | - | NO | - | 创建时间 |

#### 索引

```sql
PRIMARY KEY (id)
INDEX idx_device_id (device_id)
INDEX idx_property_key (property_key)
INDEX idx_collect_time (collect_time)
INDEX idx_device_time (device_id, collect_time)
```

#### 性能优化建议

1. **分区表**：按时间分区，便于历史数据清理
```sql
ALTER TABLE iot_device_data 
PARTITION BY RANGE (TO_DAYS(collect_time)) (
    PARTITION p202601 VALUES LESS THAN (TO_DAYS('2026-02-01')),
    PARTITION p202602 VALUES LESS THAN (TO_DAYS('2026-03-01')),
    ...
);
```

2. **定期归档**：将历史数据迁移到归档表
```sql
CREATE TABLE iot_device_data_archive LIKE iot_device_data;

-- 归档90天前的数据
INSERT INTO iot_device_data_archive 
SELECT * FROM iot_device_data 
WHERE collect_time < DATE_SUB(NOW(), INTERVAL 90 DAY);

DELETE FROM iot_device_data 
WHERE collect_time < DATE_SUB(NOW(), INTERVAL 90 DAY);
```

3. **考虑时序数据库**：数据量大时可使用 InfluxDB、TimescaleDB

---

## 规则引擎表

### iot_rule

规则表，存储自动化规则配置。

#### 表结构

| 字段名 | 类型 | 长度 | 允许NULL | 默认值 | 说明 |
|--------|------|------|---------|--------|------|
| id | VARCHAR | 50 | NO | - | 主键ID |
| rule_name | VARCHAR | 100 | NO | - | 规则名称 |
| rule_desc | TEXT | - | YES | - | 规则描述 |
| rule_type | VARCHAR | 20 | NO | - | 规则类型：DEVICE_LINK-设备联动 |
| workflow_data | TEXT | - | YES | - | 工作流数据（JSON） |
| status | VARCHAR | 20 | NO | DISABLE | 状态：ENABLE/DISABLE |
| integrity_status | VARCHAR | 20 | YES | empty | 完整性状态：valid/invalid/empty |
| integrity_issues | INT | - | YES | 0 | 完整性问题数量 |
| sort_code | INT | - | YES | 100 | 排序码 |
| ext_json | TEXT | - | YES | - | 扩展信息（JSON） |
| create_time | DATETIME | - | NO | - | 创建时间 |
| create_user | VARCHAR | 50 | NO | - | 创建人 |
| update_time | DATETIME | - | YES | - | 更新时间 |
| update_user | VARCHAR | 50 | YES | - | 更新人 |
| delete_flag | VARCHAR | 20 | NO | NOT_DELETE | 删除标记 |

#### 索引

```sql
PRIMARY KEY (id)
INDEX idx_status (status)
INDEX idx_integrity_status (integrity_status)
INDEX idx_rule_type (rule_type)
```

#### workflow_data 字段格式

```json
{
  "nodes": [
    {
      "id": "node_1",
      "type": "trigger",
      "properties": {
        "triggerType": "device",
        "deviceId": "1"
      }
    },
    {
      "id": "node_2",
      "type": "condition",
      "properties": {
        "conditionType": "simple",
        "deviceSource": "inherit",
        "property": "temperature",
        "operator": ">",
        "value": 30
      }
    },
    {
      "id": "node_3",
      "type": "action",
      "properties": {
        "actionType": "deviceCommand",
        "targetDeviceId": "2",
        "command": "turnOn"
      }
    }
  ],
  "edges": [
    {
      "id": "edge_1",
      "sourceNodeId": "node_1",
      "targetNodeId": "node_2"
    },
    {
      "id": "edge_2",
      "sourceNodeId": "node_2",
      "targetNodeId": "node_3"
    }
  ]
}
```

---

### iot_rule_log

规则执行日志表，记录规则的执行情况。

#### 表结构

| 字段名 | 类型 | 长度 | 允许NULL | 默认值 | 说明 |
|--------|------|------|---------|--------|------|
| id | VARCHAR | 50 | NO | - | 主键ID |
| rule_id | VARCHAR | 50 | NO | - | 规则ID |
| rule_name | VARCHAR | 100 | NO | - | 规则名称 |
| execute_status | VARCHAR | 20 | NO | - | 执行状态：SUCCESS/FAILED |
| execute_message | TEXT | - | YES | - | 执行信息 |
| execute_time | DATETIME | - | NO | - | 执行时间 |
| create_time | DATETIME | - | NO | - | 创建时间 |

#### 索引

```sql
PRIMARY KEY (id)
INDEX idx_rule_id (rule_id)
INDEX idx_execute_status (execute_status)
INDEX idx_execute_time (execute_time)
INDEX idx_rule_time (rule_id, execute_time)
```

#### 日志清理策略

```sql
-- 删除30天前的日志
DELETE FROM iot_rule_log 
WHERE execute_time < DATE_SUB(NOW(), INTERVAL 30 DAY);

-- 定时任务（每天凌晨2点执行）
CREATE EVENT clean_rule_log
ON SCHEDULE EVERY 1 DAY
STARTS (TIMESTAMP(CURRENT_DATE) + INTERVAL 1 DAY + INTERVAL 2 HOUR)
DO
  DELETE FROM iot_rule_log 
  WHERE execute_time < DATE_SUB(NOW(), INTERVAL 30 DAY);
```

---

## 系统管理表

### sys_user

用户表（继承自Snowy框架）

#### 核心字段

| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | VARCHAR(50) | 主键ID |
| account | VARCHAR(50) | 账号（唯一） |
| password | VARCHAR(200) | 密码（BCrypt加密） |
| name | VARCHAR(50) | 姓名 |
| phone | VARCHAR(20) | 手机号 |
| email | VARCHAR(100) | 邮箱 |
| status | VARCHAR(20) | 状态：ENABLE/DISABLE |

### sys_role

角色表（继承自Snowy框架）

#### 核心字段

| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | VARCHAR(50) | 主键ID |
| role_name | VARCHAR(50) | 角色名称 |
| role_code | VARCHAR(50) | 角色编码 |
| sort_code | INT | 排序码 |

---

## 数据字典

### 通用枚举

#### 删除标记（delete_flag）
- `NOT_DELETE`: 未删除
- `DELETE`: 已删除（软删除）

#### 状态（status）
- `ENABLE`: 启用
- `DISABLE`: 禁用

### 业务枚举

#### 协议类型（protocol_type）
- `MODBUS_TCP`: Modbus TCP协议
- `MODBUS_RTU`: Modbus RTU协议
- `S7`: 西门子S7协议
- `BACNET`: BACnet协议

#### 在线状态（online_status）
- `ONLINE`: 在线
- `OFFLINE`: 离线

#### 数据类型（data_type）
- `INT`: 整型
- `FLOAT`: 浮点型
- `STRING`: 字符串
- `BOOLEAN`: 布尔型

#### 完整性状态（integrity_status）
- `valid`: 完整，配置正确
- `invalid`: 不完整，存在配置问题
- `empty`: 未配置工作流

#### 执行状态（execute_status）
- `SUCCESS`: 执行成功
- `FAILED`: 执行失败

---

## 数据库视图

### v_device_status

设备状态视图，便于查询设备在线情况。

```sql
CREATE VIEW v_device_status AS
SELECT 
    d.id,
    d.device_name,
    d.device_code,
    p.product_name,
    p.protocol_type,
    d.online_status,
    d.last_online_time,
    CASE 
        WHEN d.online_status = 'ONLINE' THEN '在线'
        WHEN d.online_status = 'OFFLINE' THEN '离线'
    END AS online_status_text
FROM iot_device d
LEFT JOIN iot_product p ON d.product_id = p.id
WHERE d.delete_flag = 'NOT_DELETE';
```

### v_rule_integrity

规则完整性视图，统计规则配置情况。

```sql
CREATE VIEW v_rule_integrity AS
SELECT 
    status,
    integrity_status,
    COUNT(*) as rule_count
FROM iot_rule
WHERE delete_flag = 'NOT_DELETE'
GROUP BY status, integrity_status;
```

---

## 数据库升级

### Flyway 版本管理

数据库升级脚本位于：`src/main/resources/db/migration`

#### 命名规范

```
V版本号__描述.sql
例如：V20260111__add_rule_integrity_fields.sql
```

#### 升级流程

1. 创建升级脚本
2. 放入 migration 目录
3. 重启服务自动执行升级
4. 检查 `flyway_schema_history` 表确认升级成功

#### 示例脚本

```sql
-- V20260111__add_rule_integrity_fields.sql
-- 添加规则完整性字段
ALTER TABLE iot_rule 
ADD COLUMN integrity_status VARCHAR(20) DEFAULT 'empty' 
COMMENT '完整性状态：valid-完整，invalid-不完整，empty-未配置';

ALTER TABLE iot_rule 
ADD COLUMN integrity_issues INT DEFAULT 0 
COMMENT '完整性问题数量';
```

---

## 数据备份与恢复

### 备份策略

**全量备份**
```bash
#!/bin/bash
DATE=$(date +%Y%m%d_%H%M%S)
mysqldump -u root -p --single-transaction \
  --routines --triggers --events \
  iot_gateway > backup_full_${DATE}.sql
```

**增量备份**
```bash
# 启用 binlog
# 在 my.cnf 中配置
log-bin=mysql-bin
binlog_format=ROW
expire_logs_days=7
```

**数据表备份**
```bash
# 仅备份核心业务表
mysqldump -u root -p iot_gateway \
  iot_product iot_device iot_rule \
  > backup_core_${DATE}.sql
```

### 恢复方法

**全量恢复**
```bash
mysql -u root -p iot_gateway < backup_full_20260111.sql
```

**表级恢复**
```bash
# 恢复单个表
mysql -u root -p iot_gateway \
  -e "source backup_table.sql"
```

**基于时间点恢复**
```bash
# 使用 binlog 恢复到指定时间
mysqlbinlog --stop-datetime="2026-01-11 15:00:00" \
  mysql-bin.000001 | mysql -u root -p iot_gateway
```

---

## 性能优化建议

### 1. 索引优化

```sql
-- 复合索引优化查询
CREATE INDEX idx_device_status_time 
ON iot_device(online_status, last_online_time);

-- 覆盖索引减少回表
CREATE INDEX idx_device_list 
ON iot_device(product_id, device_name, online_status);
```

### 2. 查询优化

```sql
-- 使用 EXPLAIN 分析查询
EXPLAIN SELECT * FROM iot_device WHERE product_id = '1';

-- 避免全表扫描
-- Bad
SELECT * FROM iot_device_data WHERE DATE(collect_time) = '2026-01-11';

-- Good
SELECT * FROM iot_device_data 
WHERE collect_time >= '2026-01-11 00:00:00' 
  AND collect_time < '2026-01-12 00:00:00';
```

### 3. 表分区

```sql
-- 按月分区历史数据表
ALTER TABLE iot_device_data
PARTITION BY RANGE (YEAR(collect_time)*100 + MONTH(collect_time)) (
    PARTITION p202601 VALUES LESS THAN (202602),
    PARTITION p202602 VALUES LESS THAN (202603),
    PARTITION p202603 VALUES LESS THAN (202604)
);
```

### 4. 连接池配置

```yaml
spring:
  datasource:
    hikari:
      minimum-idle: 10
      maximum-pool-size: 50
      connection-timeout: 30000
      idle-timeout: 600000
      max-lifetime: 1800000
```

---

## 附录

### A. 建表语句生成

可以使用以下命令导出完整建表语句：

```bash
mysqldump -u root -p --no-data iot_gateway > schema.sql
```

### B. 数据字典导出

```sql
SELECT 
    TABLE_NAME as '表名',
    COLUMN_NAME as '字段名',
    COLUMN_TYPE as '类型',
    IS_NULLABLE as '允许NULL',
    COLUMN_DEFAULT as '默认值',
    COLUMN_COMMENT as '说明'
FROM information_schema.COLUMNS
WHERE TABLE_SCHEMA = 'iot_gateway'
ORDER BY TABLE_NAME, ORDINAL_POSITION;
```

### C. 表大小统计

```sql
SELECT 
    TABLE_NAME as '表名',
    ROUND(((DATA_LENGTH + INDEX_LENGTH) / 1024 / 1024), 2) as '大小(MB)',
    TABLE_ROWS as '行数'
FROM information_schema.TABLES
WHERE TABLE_SCHEMA = 'iot_gateway'
ORDER BY (DATA_LENGTH + INDEX_LENGTH) DESC;
```

---

**文档版本**: 1.0  
**最后更新**: 2026-01-11  
**维护人员**: 开发团队

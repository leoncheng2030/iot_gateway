# WQS IoT Gateway：企业级开源物联网网关平台

## 前言

在工业4.0和智能制造的浪潮下，设备数据采集和设备互联互通成为企业数字化转型的关键环节。然而，现场设备协议多样、系统集成复杂、开发成本高昂等问题一直困扰着开发者。

今天给大家介绍一款开源的企业级物联网网关管理平台 —— **WQS IoT Gateway**，它能够帮助你快速构建设备接入、数据采集、协议转换和设备管理的完整解决方案。

## 项目简介

WQS IoT Gateway 是一款功能强大的智能物联网网关管理平台，致力于为企业提供统一的设备接入、数据采集、协议转换和设备管理解决方案。

**在线体验**
- 演示地址：http://gateway.hn-dc.com/
- 账号：`bizAdmin`
- 密码：`123456`

## 核心特性

### 1. 多协议支持

平台原生支持主流工业协议，实现异构设备的统一接入：

- **Modbus TCP/RTU** - 工业领域最广泛的通信协议
- **西门子 S7** - 支持S7-200/300/400/1200/1500系列PLC
- **BACnet** - 楼宇自动化行业标准协议

通过插件化架构，还可以轻松扩展支持自定义协议。

### 2. 可视化配置

告别繁琐的代码编写，通过直观的 Web 界面完成所有配置：

- **产品物模型定义** - 拖拽式定义设备属性、命令和报警
- **寄存器映射配置** - 可视化配置协议地址与物模型的映射关系
- **规则引擎编排** - 流程图方式设计自动化规则，无需编程

### 3. 强大的规则引擎

平台内置的规则引擎支持复杂的业务逻辑：

- **设备触发** - 监听设备数据变化，自动触发流程
- **条件判断** - 支持简单条件和复杂条件组合
- **设备继承** - 条件节点自动继承上游触发器的设备上下文
- **动作执行** - 设备控制、数据上报、系统通知等
- **完整性检查** - 自动校验规则配置，防止配置错误

### 4. 实时监控

全方位的设备状态监控和数据追溯：

- 设备在线/离线状态实时展示
- 数据采集日志全程可追溯
- 规则执行日志详细记录
- 故障快速定位和诊断

### 5. 安全可靠

符合企业级安全要求：

- 集成国密 SM2/SM3/SM4 加密算法
- 细粒度的 RBAC 权限控制
- 完整的操作审计日志
- 符合等保要求

## 技术架构

### 后端技术栈

```
Spring Boot 3.x       应用框架
MyBatis Plus          ORM框架
Redis                 缓存中间件
MySQL                 数据存储
Flyway                数据库版本管理
国密算法              SM2/SM3/SM4
```

### 前端技术栈

```
Vue 3                 渐进式框架
Ant Design Vue 4      UI组件库
Vite 5                构建工具
Pinia                 状态管理
LogicFlow             流程编排引擎
```

### 项目结构

项目采用插件化架构设计，实现模块分离和高度解耦：

```
iot_gateway
  ├─ snowy-admin-web          前端管理平台
  ├─ snowy-common             基础公共模块
  ├─ snowy-plugin             功能插件模块
  │   ├─ snowy-plugin-auth    认证鉴权
  │   ├─ snowy-plugin-biz     业务功能
  │   ├─ snowy-plugin-iot     IoT设备管理（核心）
  │   ├─ snowy-plugin-sys     系统管理
  │   └─ snowy-plugin-dev     开发工具
  ├─ snowy-plugin-api         插件API接口
  └─ snowy-web-app            主启动模块
```

## 应用场景

### 智能制造

在生产车间，WQS IoT Gateway 可以：
- 采集生产设备的运行数据
- 监控设备状态和生产进度
- 实现设备间的联动控制
- 将数据上报到 MES/ERP 系统

### 智慧园区

在园区管理中，可以应用于：
- 能源管理与环境监测
- 智能照明与空调控制
- 安防设备统一接入
- 数据大屏可视化展示

### 智能楼宇

在楼宇自控领域：
- BA 系统协议转换
- 暖通空调系统监控
- 能耗数据采集分析
- 与物业管理系统集成

### 智慧农业

在农业物联网应用中：
- 农业传感器数据汇聚
- 环境参数自动调控
- 远程监控与管理
- 数据分析与决策支持

## 快速开始

### 环境准备

| 组件 | 版本要求 |
|------|----------|
| JDK | 17 |
| Node.js | ≥ 18 |
| MySQL | 8.0 / 5.7 |
| Redis | 最新版 |
| Maven | 最新版 |

### 启动步骤

**1. 克隆项目**

```bash
git clone https://github.com/yourusername/iot_gateway.git
cd iot_gateway
```

**2. 初始化数据库**

创建数据库并导入初始化脚本（Flyway会自动执行迁移）

**3. 配置文件**

修改 `application.yml` 配置数据库和 Redis 连接信息

**4. 启动后端**

```bash
cd snowy-web-app
mvn spring-boot:run
```

**5. 启动前端**

```bash
cd snowy-admin-web
npm install
npm run dev
```

**6. 访问系统**

浏览器打开 http://localhost:5173

默认账号：`superAdmin` / `123456`

## 核心功能演示

### 1. 产品管理

创建产品并定义物模型：

**步骤**：
1. 进入"产品管理"菜单
2. 点击"新增产品"
3. 填写产品信息（名称、协议类型等）
4. 定义产品属性（温度、湿度等）
5. 配置寄存器映射（协议地址与属性的对应关系）

**示例**：创建一个 Modbus TCP 温湿度传感器产品
- 属性1：温度（FLOAT，只读）→ 映射到功能码03，地址0，INT16，缩放0.1
- 属性2：湿度（FLOAT，只读）→ 映射到功能码03，地址1，INT16，缩放0.1

### 2. 设备管理

添加设备实例：

**步骤**：
1. 选择已创建的产品
2. 点击"添加设备"
3. 填写设备信息
4. 配置设备地址（IP、端口、从站号等）
5. 启用设备

系统会自动开始采集数据，实时显示设备状态。

### 3. 规则引擎

创建自动化规则：

**场景**：当温度超过30°C时，自动开启风扇

**配置流程**：
1. 添加"设备触发"节点，选择温度传感器
2. 添加"条件判断"节点，配置条件：`temperature > 30`
3. 添加"设备控制"节点，选择风扇，发送开启命令
4. 连接节点形成流程
5. 启用规则

系统会自动校验规则完整性，并在满足条件时执行动作。

### 4. 数据查询

查看历史数据：

1. 进入"数据查询"菜单
2. 选择设备和时间范围
3. 查看数据趋势图表
4. 导出数据报表

## 技术亮点

### 1. 寄存器映射的灵活性

通过数据库存储协议映射配置，支持：
- 不同数据类型的自动转换（INT16/INT32/FLOAT等）
- 字节序配置（大端/小端）
- 缩放因子处理
- 位操作支持

### 2. 规则引擎的设备继承

条件节点可以自动继承上游触发器的设备上下文，简化配置：

```javascript
// 触发器：设备A的温度变化
// 条件节点：自动继承设备A，可以直接选择设备A的其他属性进行判断
// 无需重复选择设备
```

### 3. 完整性检查机制

规则保存时自动校验：
- 是否有触发器节点
- 节点配置是否完整
- 节点之间的连接是否合理
- 设备是否可用

### 4. 插件化协议扩展

通过实现 `ProtocolServer` 接口，可以轻松扩展新协议：

```java
public interface ProtocolServer {
    void start();
    void stop();
    void readData(Device device);
    void writeData(Device device, String property, Object value);
}
```

## 开发计划

项目持续迭代中，近期规划：

- [ ] 支持 MQTT 协议
- [ ] 支持 OPC UA 协议
- [ ] 数据转发到云平台（阿里云、华为云）
- [ ] SCADA 组态画面
- [ ] 移动端 APP
- [ ] 边缘计算能力增强

## 常见问题

### Q1: 支持哪些数据库？

目前支持 MySQL 5.7 / 8.0，后续会考虑支持 PostgreSQL。

### Q2: 能否部署到 Docker？

可以，项目支持 Docker 部署，可以参考部署文档。

### Q3: 协议驱动如何扩展？

实现 `ProtocolServer` 接口并注册到 Spring 容器即可。

### Q4: 数据存储容量如何？

建议按时间分区存储历史数据，定期归档到时序数据库（如 InfluxDB）。

### Q5: 性能如何？

单网关实例可以支持：
- 1000+ 设备接入
- 10000+ 数据点采集
- 毫秒级实时响应

## 致谢

本项目基于 [Snowy](https://gitee.com/xiaonuobase/snowy) 开源框架构建，在此特别感谢 Snowy 团队提供的优秀基础框架。Snowy 是国内首个国密前后端分离快速开发平台，其简洁的代码架构和完善的功能模块为本项目的快速开发提供了坚实基础。

## 总结

WQS IoT Gateway 是一款功能完善、易于使用的开源物联网网关平台，具有以下优势：

1. **开箱即用** - 完整的功能模块，快速部署上线
2. **协议丰富** - 支持主流工业协议，满足多样化需求
3. **配置简单** - 可视化配置界面，降低使用门槛
4. **扩展灵活** - 插件化架构，支持自定义扩展
5. **企业级** - 安全可靠，符合生产环境要求

无论你是工业物联网开发者、系统集成商，还是企业IT部门，WQS IoT Gateway 都能帮助你快速构建设备接入和数据采集系统，加速数字化转型进程。

## 项目链接

- 在线演示：http://gateway.hn-dc.com/
- 源码地址：[待补充]
- 技术文档：项目 docs 目录
- 问题反馈：[待补充]

## 最后

如果这个项目对你有帮助，欢迎 Star 支持！也欢迎提交 Issue 和 PR，一起完善这个项目。

---

**关键词**：物联网、IoT、网关、Modbus、S7、BACnet、设备管理、数据采集、Spring Boot、Vue3

**标签**：`#物联网` `#IoT` `#开源项目` `#SpringBoot` `#Vue3` `#边缘计算`
